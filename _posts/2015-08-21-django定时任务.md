---
layout: detail
title: django定时调度
description: 介绍在django中定时任务的几种实现方式
category: project
tags: [project ,core ,django ,python ,blog ,django-rq ,django-schedule ,crontab ,share]
---

# 定时调度的问题

pip install rq_scheduler

## 工作原理
*Putting a job in the scheduler

*Running a scheduler that will move scheduled jobs into queues when the time comes

*RQ Scheduler comes with a script rqscheduler that runs a scheduler process that polls Redis once every minute and move scheduled jobs to the relevant queues when they need to be executed:

```
scheduler.schedule(
    scheduled_time=datetime.now(), # Time for first execution, in UTC timezone
    func=func,                     # Function to be queued
    args=[arg1, arg2],             # Arguments passed into function when executed
    kwargs={'foo': 'bar'},         # Keyword arguments passed into function when executed
    interval=60,                   # Time before the function is called again, in seconds
    repeat=10                      # Repeat this number of times (None means repeat forever)
)
```


#初始化：
```
In [1]: from analytics.etl import analytics_etl
In [2]: analytics_etl.init()
```



1. 安装rq_scheduler
2. 编写测试command   scheduler_command.py

```
class Command(BaseCommand):

    help = "process  analytics data"

    def handle(self, *args, **options):
        first_process_datetime=datetime.now()+timedelta(days=1)
        first_process_datetime.replace(hour=1,minute=0,second=0,microsecond=0)
        first_process_datetime=dateformat.local_to_utc(first_process_datetime)
        scheduler.schedule(first_process_datetime,process,interval=interval)

```

###使用方法
##调用job

```
python manage.py scheduler_command --settings=local_settings
```

##启动rqscheduler

```
rqscheduler执行一次就ＯＫ
python manage.py rqscheduler --settings=local_settings
```

## 启动一个rqworker default

```
启动一个工作者，
python manage.py rqworker default --settings=local_settings
```

##查看当前有多少job:

```
import django_rq

scheduler=django_rq.get_scheduler('default')

jobs=scheduler.get_jobs()
```

##取消job

```scheduler.cancel(job)```

